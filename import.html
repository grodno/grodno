<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

        <title>Import</title>
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <script src="libs/axio.js"></script>

        <script>
            
            var APP = {
                ID : 'grodno.co'
                ,
                TITLE : 'Grodno'
                ,
                VERSION : '1.4.5'
                ,
                COPYRIGHT : '2013 Grodno'
                ,
                GOOGLE_SHEETS_URI:'https://script.google.com/macros/s/AKfycbx1AsNPawV5QDldh0obaSRkSzaYT1ZA3mbQK40_WFMPDvUjT5cl/exec?doc='
                ,
                GOOGLE_API_KEY:'AIzaSyAGenobWLKI-F6MWzrHIXmviwJww43n2EM'//'AIzaSyA--IJRFbmFubpjcz5Yherycv6Vy48qBY0'
            };
        </script>
        <script src="app.js"></script>
        <script >
            // Lexio plugin
(function () {
    
    var Token = function(v, m, prev) {
       
        this.id = v;
        this.input = v;
        
        this.size = v.length;
        this.weight = m.weight;
        this.kind = 'e';
        this.tags = [];
        
        // sequence refs
        if (prev){
            this.prev = prev;
            prev.next = this;
        }
    }

    
    Token.prototype = {
        remove : function(){
            this.kind = null;
            this.prev && (this.prev.next = this.next);
            this.next && (this.next.prev = this.prev);
        },
        setNext : function(n){
            this.next= n;
            if (n){
                n.prev = this;
            }
        }
        ,
        setPrev : function(p){
            this.prev= p;
            if (p){
                p.next = this;
            }
        }
    }
    
    var _tokenize = (function(v, p, ev) {
        
        var prev = ev.lastToken;
        
        this.push(ev.lastToken = new Token(v.id, v, prev));

        if (!prev) {

            ev.firstToken = ev.lastToken;

        }

        
    }).iterator();   
    
    Object.entity.define("importTokenize extends lexio/Plugin",{
        requires:['lib://en_all']
        ,
        performImpl:function(err, ev) {
            
            _tokenize(window.EN_ALL.all, [], ev);
            
        }
   
    });

})();
// Lexio plugin
// show as HTML
(function () {
    
    var _op = function(t){
        var best = t.word.best;
        
        if(best.hardcoded)  return; 

        var r = best.root||best.x;
        if(!r)  return; 
        
        if (String.ROOTS[r]){
            r = String.ROOTS[r].id;
        }
        
        var d = this.roots[r] || (this.roots[r] = {id:r, weight:0, src:[]});
        d.weight+=t.weight;
        d.src.push({id:t.id, weight:t.weight});

        var sx = (best.flexie||'') ;
        if(!String.ROOTS[r] || !sx)  return; 
        
        var s = this.suffixes[sx] || (this.suffixes[sx] = {id:sx, weight:0, src:[]});
        s.weight+=1;
        if (s.weight<10){
            s.src.push({id:t.id, weight:t.weight});
        }

    };
    
    var _html = function(t){
        if (String.ROOTS[t.id]){
            t.src= (function(e){this.push(e.id+':'+e.weight)}).iterator()(Array.sortBy(t.src,'weight',-1),[]).join(',');
        
            this.value += String.formatWithMap("\\n{weight}\t{id}\t{src}", t);
        }
    };
    
    var _html2 = function(t){
        var srcL = t.src.length;
            
        if (t.id.length>2 && !String.ROOTS[t.id]){
            if (srcL>2) {
                t.src= (function(e){this.push(e.id+':'+e.weight)}).iterator()(Array.sortBy(t.src,'weight',-1),[]).join(',');
        
        
                this.value += String.formatWithMap("\\n{weight}\t{id}\t{src}", t);
            }
            
        }
    }; 
    var _htmlSx= function(t){
        //if (String.ROOTS[t.id]){
            t.src= (function(e){this.push(e.id+':'+e.weight)}).iterator()(Array.sortBy(t.src,'weight',-1),[]).join(',');
        
            this.value += String.formatWithMap("\\n{weight}\t{id}\t{src}", t);
        //}
    };


    Object.entity.define("importRepresent extends lexio/Plugin", {
        
        methods: function(_super){
            
            return {
                
                // implementation of perform on event
                performImpl: function(err, ev){
                    
                    ev.value = '';
                    ev.roots = {};
                    ev.suffixes = {};

                    ev.eachToken(_op);
                    
                    // unused roots
                    Function.iterate(function(t){
                        if (!this.roots[t.id]){
                            this.value += String.formatWithMap("\\n{weight}\t{id}\t-", t);
                        }
                    }, String.ROOTS,ev);
                    
                    // make array and sort
                    ev.roots = Function.iterate(function(d){this.push(d)}, ev.roots,[]);
                    Array.sortBy(ev.roots,'weight',-1);
                    
                    Function.iterate(_html, ev.roots,ev);
                    Function.iterate(_html2, ev.roots,ev);
                    
                    
                    //Function.iterate(_htmlSx, Array.sortBy(Function.iterate(function(d){this.push(d)}, ev.suffixes,[]),'weight',-1),ev);
                    
                    
                    window.container.innerHTML = ev.value;//
                }
            };
        }
    });
    
})();

// reset meta-en
window.localStorage['lexio_meta:1JBxZVPj4pbHVlywPd9YzXyAVUrliAnOfFQ5zW57zoBA']=null;


// Lexio handler instance
Object.entity.create({
    id:"lexio/Processor:lexio"
    ,
    plugins:[
    {
        id:'lexio/plugin/initialize'
    }
    ,{
        id:'lexio/plugin/meta'
        ,
        sources:[
         'lexio_meta://1JBxZVPj4pbHVlywPd9YzXyAVUrliAnOfFQ5zW57zoBA'
        ]
        //https://script.google.com/macros/s/AKfycbx1AsNPawV5QDldh0obaSRkSzaYT1ZA3mbQK40_WFMPDvUjT5cl/exec
    //var EN = GSheets.getSpreadsheetData('0AqQx4KOOt8TGdEFhUExMU3ZsaVl3RDBiWXhtcWVDZ2');
  
    }
    ,
    {
        id:'importTokenize'
    }
    ,
    {
        id:'lexio/plugin/lexer'
    }
    ,
    {
        id:'lexio/plugin/score'
    }
    ,
    {
        id:'importRepresent'
    }
    ]
});
            

            
        </script>
    </head>


    <body>
    <button onclick="Object.notify('lexio://#');this.style.display='none';">Do it</button>
<pre id="container">
    
</pre>
    </body>
</html>