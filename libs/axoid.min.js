(function(){"use strict";var t,e,n={}.hasOwnProperty;t=Function,t.nextTick=function(t,e,n){return 1===arguments.length&&(n=t)&&(t=null)&&(e=null),2===arguments.length&&(n=e)&&(e=t)&&(t=null),setTimeout(function(){return n.call(e)},t||5)},t.iterate=function(t,e,r,i){var o,u,s,a,l,c;if(e)if(u=e.length,u===+u)for(o=l=0,c=e.length;c>l;o=++l)a=e[o],t.call(r,a,o,i);else for(s in e)n.call(e,s)&&(a=e[s],t.call(r,a,s,i));return r},t.perform=function(t,n){var r,i,o,u,s;return i=1,u=[null,void 0],s=function(){var t,n;if(!--i&&(t=r.operations.shift())){i=1,n=[].concat(u),u=[null,void 0];try{return t.apply(r.context,n)}catch(o){return o.op=(""+t).slice(0,151).replace(/\n+/g," "),e.error(o).addDetails(r._error).log()}}},o=function(t){return function(n,r){return void 0===u[t]?(n&&(u[0]=e.error(n).log()),u[t]=r,s()):void 0}},r={context:t,_error:new Error,next:o(1),wait:function(){var t;return t=u.length,u[t]=void 0,i+=1,o(t)}},r.operations=n.call(t,r),s()},t.create=function(t,e){return t?Object.parse("("+(e?e.join(", "):"")+")->\n	"+t.replace(/\n/g,"\n	"),{language:"coffeescript"}):null},e=Object,e.update=function(t,e){var r;if(t&&e)for(r in e)n.call(e,r)&&(t[r]=e[r]);return t},e.prop=function(t,e,n){var r,i,o;if(!t)return null;if(i=-1,arguments.length>2){for(;(i=e.indexOf(".",o=i+1))>-1;)t=t[r=e.slice(o,+(i-1)+1||9e9)]||(t[r]={});return t[e.slice(o)]=n}for(;t&&(i=e.indexOf(".",o=i+1))>-1;)t=t[e.slice(o,+(i-1)+1||9e9)];return null!=t?t[e.slice(o)]:void 0},e.clone=function(t,e){var r,i;if(!t)return null;i=new t.constructor;for(r in t)n.call(t,r)&&(i[r]=t[r]);if(e)for(r in e)n.call(e,r)&&(i[r]=e[r]);return i},e.parse=function(n,r){if(!n)return null;try{return"coffeescript"===(null!=r?r.language:void 0)&&(n=CoffeeScript.compile(n,{bare:!0})),t.call(t,"return "+n).call(null!=r?r.ctx:void 0)}catch(i){return e.error("bad-code: Object.parse: "+i.message).addDetails(n).log().end(null)}},String.LANGUAGE="en",String.capitalize=function(t){return(null!=t?t.length:void 0)?t[0].toUpperCase()+t.slice(1):""},String.camelize=function(t,e){var n,r;return null==e&&(e="_"),(null!=t?t.length:void 0)?function(){var i,o,u,s;for(u=t.split(e),s=[],n=i=0,o=u.length;o>i;n=++i)r=u[n],s.push(n?String.capitalize(r):r);return s}().join(""):""},String.localize=function(t){var n;return n=function(e,n){var r;return null==n&&(n=String.LANGUAGE),e?(null!=(r=t[n])?r[e]:void 0)||String.capitalize(String.camelize(e)):""},n.get=function(e,n){var r;return null==n&&(n=String.LANGUAGE),e?(null!=(r=t[n])?r[e]:void 0)||null:null},n.add=function(n,r){return 1===arguments.length&&(r=n)&&(n=null),n||(n=String.LANGUAGE),e.update(t[n]||(t[n]={}),r)},n}({}),String.format=function(t){var e,n;return t?(e=function(){var t,e,r;for(r=[],t=0,e=arguments.length;e>t;t++)n=arguments[t],r.push(n);return r}.apply(this,arguments),t.replace(/\{(\d+)\}/g,function(t,n){return e[+n+1]||""})):""},String.template=function(){var t,n,r,i;return i=function(t){var e,n,r,i,o,u,s,a;for(i={tag:"top",children:[]},u=[],r=0,e=/{{([?\/:#]?)([a-zA-Z0-9\._]+)((\|[a-z]+)*)}}/g;n=e.exec(t);)n.index&&(a=t.slice(r,+(n.index-1)+1||9e9))&&i.children.push({tag:"_",value:a}),s=n[2],"?"===n[1]||"#"===n[1]?(u.unshift(i),i.children.push(o={tag:s,children:[],flag:n[1]}),i=o):"/"===n[1]?i=u.shift():":"===n[1]?i=i["_"+s]={children:[]}:i.children.push({tag:s}),r=e.lastIndex;return r&&(t=t.slice(r))&&i.children.push({tag:"_",value:t}),i},r=function(n,i){var o,u,s,a,l,c,d,h,p,f;if(s=[],n.children)for(f=n.children,c=0,h=f.length;h>c;c++)if(u=f[c],"_"===(a=u.tag))s.push(u.value);else if(l="."===a?i:e.prop(i,a))if(Array.isArray(l))if(l.length)if("?"===u.flag)s.push(r(u,i));else for(d=0,p=l.length;p>d;d++)o=l[d],o&&s.push(r(u,o));else u._else&&s.push(r(u._else,"?"===u.flag?i:l));else s.push(r(u,"?"===u.flag?i:l));else u._else&&s.push(r(u._else,"?"===u.flag?i:l));else s.push(t.writeValue(i,s));return s.join("")},t=function(t,e){return r(i(t),e)},t.filters={},n=function(t){return"&#"+t.charCodeAt(0)+";"},t.writeValue=function(t){return(""+t).replace(/[\u00A0-\u9999<>\&]/g,n)},t}(),function(t,e){var n;return n=function(t){return t&&(t=""+t)&&(t.length<2?"0"+t:t)||"00"},Date.PATTERN_PARSE="yyyy-MM-dd",Date.PATTERN_FORMAT="dd MMM yyyy",Date.daysInMonth=function(e,n){return(1===e&&n%4===0?1:0)+t[e]},Date.getTimeZone=function(){var t,r,i;return t=-e.getTimezoneOffset(),i=""+Math.abs(t/60),r=""+Math.abs(t%60),"GMT"+(0===t&&""||"%2"+(t>0?"B":"D")+n(i)+":"+n(r))},Date.parse=function(t,e){var n,r,i;return null==e&&(e=Date.PATTERN_PARSE),t?t instanceof Date?t:(n=new Date,n.setDate(1),i=""+e,(r=i.indexOf("yyyy"))>-1?n.setFullYear(t.substr(r,4)):(r=i.indexOf("yy"))>-1&&n.setFullYear(2e3+t.substr(r,2)),(r=i.indexOf("MM"))>-1&&n.setMonth(Number(t.substr(r,2))-1),(r=i.indexOf("dd"))>-1&&n.setDate(Number(t.substr(r,2))),n.setHours((r=i.indexOf("HH"))>-1?t.substr(r,2):12),n.setMinutes((r=i.indexOf("mm"))>-1?t.substr(r,2):0),n.setSeconds((r=i.indexOf("ss"))>-1?t.substr(r,2):0),n):null},Date.shiftedWithDays=function(t,e){var n;return n=new Date,n.setTime((t||n).getTime()+864e5*(e||0)),n},Date.days=function(t){return t&&t.getTime?(t=t.getTime(),(t-t%864e5)/864e5):0},Date.compare=function(t,e){return t&&e?t.getTime&&e.getTime?t.getTime()>e.getTime()?1:-1:0:t||e?t?1:-1:0},Date.monthName=function(t,e){var r;return null!=(r=String.localize.get("MONTH",e))?r[n(t+1)]:void 0},Date.format=function(t,e,r){var i;return i="",t&&t.getFullYear&&(i+=e||Date.PATTERN_FORMAT,i=i.replace("yyyy",""+t.getFullYear()),i=i.replace("yy",""+t.getFullYear()),i=i.replace("MMMM",Date.monthName(t.getMonth(),r)),i=i.replace("MMM",Date.monthName(t.getMonth(),r,"MONTH_SHORT")),i=i.replace("MM",n(t.getMonth()+1)),i=i.replace("dd",n(t.getDate())),i=i.replace("hh",n(t.getHours())),i=i.replace("mm",n(t.getMinutes())),i=i.replace("ss",n(t.getSeconds()))),i},String.localize.add("en",{DOW:{1:"Su",2:"Mo",3:"Tu",4:"We",5:"Th",6:"Fr",7:"Sa"},MONTH_SHORT:{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},MONTH:{"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"}})}([31,28,31,30,31,30,31,31,30,31,30,31,31],new Date),e.math={decimalAdjust:function(t,e,n){return"undefined"==typeof n||0===+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!==0?0/0:(e=e.toString().split("e"),e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+n:n))))},round:function(t,e){return null==e&&(e=0),this.decimalAdjust("round",t,e)},uuid:function(){var t;return t=Date.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n;return n=(t+16*Math.random())%16|0,t=Math.floor(t/16),("x"===e?n:7&n|8).toString(16)})},sort:function(t,e,n){var r,i;return n||(n=1),i=-1*n,r="string"==typeof e?function(t){return null!=t?t[e]:void 0}:e||function(){},t.sort(function(t,e){var o,u;return(o=r(t))>(u=r(e))?n:u>o?i:0})}},e.Uri=function(){function t(){this.params={}}return t.prototype.isUri=!0,t.prototype.toString=function(){var t,e,r,i,o;e=(this.host?this.type?""+this.type+"://"+this.host+"/":"//"+this.host+"/":"")+this.path.join("/"),r="?",o=this.params;for(t in o)n.call(o,t)&&(i=o[t],e+=r+t+"="+encodeURIComponent(i),"?"===r&&(r="&"));return this.hash&&(e+="#"+this.hash),e},t.parse=function(e){var n,r,i,o,u,s,a;if(null!=e?e.isUri:void 0)return e;if(r=new t,!e)return r;if(e.split||(e=""+e),(n=e.indexOf("://"))>-1&&(r.type=e.slice(0,+(n-1)+1||9e9),e=e.slice(n+1)),(n=e.indexOf("#"))>-1&&(r.hash=e.slice(n+1),e=e.slice(0,+(n-1)+1||9e9)),s=e.split("?"),e=s[0],r.query=s[1],r.query)for(a=r.query.split("&"),o=0,u=a.length;u>o;o++)i=a[o],(n=i.split("=")).length>1&&(r.params[n[0]]=decodeURIComponent(n[1]));return r.id=e,n=e.split("/"),""===n[0]&&(n.shift(),""===n[0]&&(n.shift(),r.host=n.shift())),r.path=n,r},t}(),e.error=function(){var t;return t=function(){function t(t){this.details=[],"string"==typeof t?(t&&(this.reason=t.split(":")[0]),t&&(this.message=t)):(t.reason&&(this.reason=t.reason),t.message&&(this.message=t.message))}return t.prototype.reason="unknown",t.prototype.message="",t.prototype.isError=!0,t.prototype.addDetails=function(){var t,e,n;for(e=0,n=arguments.length;n>e;e++)t=arguments[e],t&&(this.details.unshift(t),t.stack&&(this.stack=t.stack));return this},t.prototype.addPrefix=function(t){return t&&(this.prefix=""+t),this},t.prototype.log=function(){return e.log(this),this},t.prototype.end=function(t){return t},t.prototype.toString=function(){return""+(this.prefix||"")+" "+this.message},t.prototype.printIntoLog=function(t){var e,n;return e=("function"==typeof this.details?this.details(1===length):void 0)?this.details[0]:this.details,n=this.stack||(new Error).stack,t.error(this.toString(),e,n)},t}(),function(e,n){return((null!=e?e.isError:void 0)?e:new t(e)).addDetails(n)}}(),Object.log=function(t){return null==t&&(t={log:function(){}}),t.log.apply||(t._log=t.log,t.log=function(){var e;return t._log(function(){var t,n,r;for(r=[],t=0,n=arguments.length;n>t;t++)e=arguments[t],r.push(e);return r}.apply(this,arguments).join(", "))}),t.error||(t.error=function(){var e;return t.log.apply(t,["ERROR: "].concat(function(){var t,n,r;for(r=[],t=0,n=arguments.length;n>t;t++)e=arguments[t],r.push(e);return r}.apply(this,arguments)))}),function(e){var n;return(null!=e?e.printIntoLog:void 0)?e.printIntoLog(t):t.log.apply(t,function(){var t,e,r;for(r=[],t=0,e=arguments.length;e>t;t++)n=arguments[t],r.push(n);return r}.apply(this,arguments)),e}}(this.console)}).call(this),function(){var t,e,n,r={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e=function(){function e(t){t&&Object.update(this,t),this.uri&&(this.uri=Object.Uri.parse(this.uri))}var n,r,i,o,u,s,a,l;return r={},n={},i={},l=function(t,e){var n,i,o,u;for(i=r,u=-1;(o=t.indexOf(".",u=o+1))>-1;)i=i[n=t.slice(u,+(o-1)+1||9e9)]||(i[n]={});return i[n=t.slice(u)]||e&&(i[n]={})},s=function(t){return(n[t]||(n[t]=[])).push(this)},a=function(t){var e;for(e=null!=t?t.first:void 0;e;){try{e.handler.call(e.target,this)}catch(n){Object.error("notify: "+n.message,Object.update(n,{op:(""+e.handler).replace(/\n+/g,"").slice(9,151)})).log()}e=e.next}return this},u=function(t,e){var n,r,i,o;return null==e&&(e=this.id),o={},i=[],n=t.replace(/<(@?[\w\.$ ]+?)>/gm,function(t,n){var r,u,s,a,l;if(a=n.split(" "),n=a[0],r=a[1],l="@"===n[0]?[e,n.slice(1)]:n.split("."),u=l[0],s=l[1],s||(s="value"),n=u+"."+s,!u)throw new Error("No id for binding source in "+t);return o[n]||(o[n]=1,i.push({id:n,flag:r,entityId:u,propName:s})),'$["'+n+'"]'}),r=function(){try{return new Function("$","return "+n.replace("@","this.")+";")}catch(t){return Object.error("bad-code: Wrong binding expression: "+n,t).log(),function(){return t.message}}}(),{sources:i,message:t,expression:r}},o=function(){function t(t,e){var n;this.handler=t,this.target=null!=e?e:null,(n=(null!=e?e._id:void 0)||e)&&(i[n]||(i[n]=[])).push(this)}return t.prototype.remove=function(){return this.next?this.next.prev=this.prev:this.obj.last=this.prev||null,this.prev?this.prev.next=this.next:this.obj.first=this.next||null,this.obj=null,this},t.prototype.add=function(t){return this.obj=t,t.last?(t.last.next=this).prev=t.last:t.first=this,t.last=this},t}(),e.prototype.isEvent=!0,e.prototype.callback=function(){},e.prototype.update=function(t){return Object.update(this,t)},e.prototype.addTrace=function(t){return t?(this.trace||(this.trace=[])).push(t):void 0},e.prototype.fire=function(t){var e,n;if(!(e=this.uri.type))throw"No target specified for event "+this.uri.toString();return t&&(this.callback=t),(n=r[e])?a.call(this,n):(s.call(this,e),Object.log("!!! Defer event for ["+e+"]"))},e.isEvent=function(t){return t.isEvent},e.listen=function(t,e,r,i){var u,s,a,c;if(!t)throw new Error("No key to listen "+r);if(new o(e,r,i).add(l(t,!0)),s=n[t]){for(a=0,c=s.length;c>a;a++)u=s[a],u.fire();return delete n[t]}},e.unlisten=function(t){return delete r[t]},e.unbindForTarget=function(t){var e,n,r,o,u,s,a,l;for(l=[t.id,t._id],o=0,s=l.length;s>o;o++)if(n=l[o],n&&(r=i[n])){for(u=0,a=r.length;a>u;u++)e=r[u],e.remove();delete i[n]}return this},e.notifyPropertyChanged=function(t,e){var n;return(n=r[t])?a.call(e,n[e.propId]):void 0},e.require=function(t){var e,n;return null==t&&(t={}),e=function(t){return function(e,n){var r;for(e&&Object.error(e).log(),e||(t.isDone=1);r=t.q.shift();)r(e,n);return 1}},n=function(n,r){return(null!=n?n.length:void 0)?Function.perform(n,function(i){return[function(){var r,o,u,s;for(u=0,s=n.length;s>u;u++)o=n[u],o&&(r=t[o]||(t[o]={q:[],x:o}))&&!r.isDone&&(r.q.push(i.wait()),1===r.q.length&&Object.event.fire(o,e(r)));return i.next(null,n.length)},r]}):r(null,0)}}(),e.bindPropertyExpression=function(e,n,r){var i,o,s,a,l,c,d,h;for(i=u.call(e,r,e.id),o=!1,d=function(t){return Object.DEBUG?Object.log("binding: "+e+"["+n+"] "+t):void 0},a=function(){var u,s,a,l,c,h,p;if(!o){for(l={},p=i.sources,c=0,h=p.length;h>c;c++){if(s=p[c],!(u=t.get(s.entityId)))return d("No source of "+s.id);if(!(a=u.prop(s.propName))&&(void 0===a&&"optional"!==s.flag||"required"===s.flag))return d("No value from "+s.id);l[s.id]=a}o=!0;try{return r=i.expression.call(e,l),Object.DEBUG&&d("= ["+i.message+"] ("+(""+r).replace("\n"," ").slice(0,31)+")"),e.prop(n,r)}finally{o=!1}}},h=i.sources,l=0,c=h.length;c>l;l++)s=h[l],this.listen(s.id,a,e);return a()},e.doubleBindProperty=function(e,n,r,i){var o,u,s,a,l,c,d,h;return null==i&&(i={locked:!1}),d=r.split("."),u=d[0],s=d[1],s||(h=[r+".value","value"],r=h[0],s=h[1]),c=function(t){return Object.DEBUG?Object.log("duplex: "+e+"["+n+"] "+t):void 0},l=function(r){if(!i.locked){i.locked=!0;try{return t.get(e).prop(n,r.value)}finally{i.locked=!1}}},this.listen(r,l,e),i.reverse||((o=t.get(u))&&void 0!==(a=o.prop(s))&&l({entity:o,value:a}),i.reverse=!0,this.doubleBindProperty(u,s,e+"."+n,i)),!0},e}(),n=function(){function n(t){var e,n,r,u,s,a,l;if(this.id=t,a=this.id.split(":"),this.id=a[0],u=a[1],"Uri"===this.id.slice(-3)&&(this.asyncTarget=this.id.slice(0,-3)),u){if(!(this.type=o[u]))throw new Error("ERROR: No such property type: "+u);if((e=this.type.methods)&&(r=e(l={})))for(n in r)s=r[n],"function"==typeof s&&(l[n]=this[n]||i),this[n]=s}}var r,i,o;return i=function(){},r={},o={},n.prototype.attachToEntityCtor=function(e){var n;return(null!=(n=this.type)?n.mixin:void 0)?t.applyMixin.call(e.prototype,this.type.mixin,this):void 0},n.prototype.extractDefaults=function(t,e){var n;return t[n=this.id]&&(e[n]=t[n])&&(t[n]=void 0),t[n=this.id+"Expression"]&&(e[n]=t[n])&&(t[n]=void 0),t[n=this.id+"Binding"]&&(e[n]=t[n])&&(t[n]=void 0),this.asyncTarget||(t[n=this.id+"Uri"]&&(e[n]=t[n])&&(t[n]=void 0),t[n=this.id+"UriExpression"]&&(e[n]=t[n])&&(t[n]=void 0)),e},n.prototype.init=function(t,r){var i,o;return void 0!==(o=r[this.id])&&t.prop(this.id,{isEvent:!0,value:o,force:!0}),(r[""+this.id+"Uri"]||r[""+this.id+"UriExpression"])&&n.instance(""+this.id+"Uri").init(t,r),(i=r[""+this.id+"Binding"])&&e.doubleBindProperty(t.id,this.id,i),(i=r[""+this.id+"Expression"])?e.bindPropertyExpression(t,this.id,i):void 0},n.prototype.done=function(t){return t[this.id]=null},n.prototype.getter=function(t){return t[this.id]},n.prototype.setter=function(t,e){return t[this.id]=e},n.prototype.comparator=function(t,e){return t===e},n.prototype.asyncAdapter=function(t,e){return Object.event.create({value:e||null,error:t})},n.prototype.createAsyncValueCallback=function(t){var e;return e=t._monitor[this.id]=Object.math.uuid(),function(n){return function(r,i){return t.isDone||e!==t._monitor[n.id]?void 0:t.prop(n.id,(t[""+n.id+"AsyncAdapter"]||n.asyncAdapter).call(t,r,i))}}(this)},n.prototype.setValueForUri=function(t,e){return Object.event.fire(e,this.createAsyncValueCallback(t))},n.prototype.setValue=function(t,e){var n,r;return(null!=e?e.isEvent:void 0)||(e=Object.event.create({value:e})),e.propId=this.id,e.entity=t,e.oldValue=this.getter(t),e.uri&&(n=e.uri,e.uri=null),void 0===(r=e.value)||!e.force&&this.comparator(r,e.oldValue)||(this.setter(t,r,e),this.asyncTarget&&r&&t.prop(this.asyncTarget,Object.event.create({value:null,uri:r,force:!0})),t.propertyChanged(e)),n&&this.setValueForUri(t,n),e},n.define=function(t){return o[t.id]=t},n.instance=function(t){return r[t]||(r[t]=new n(t))},n}(),t=function(){function t(){}var o,u,s,a;return u=function(){},o={},a={},s=0,t.prototype.launch=function(t){return this.init(),"function"==typeof t?t(null,this):void 0},t.prototype.init=function(){var t,n,r,i,o;t={},i=this.constructor.properties;for(n in i)r=i[n],r.extractDefaults(this,t);o=this.constructor.properties;for(n in o)r=o[n],r.init(this,t);return this.onEvent&&e.listen(this.id,this.onEvent,this),"function"==typeof this.onInited?this.onInited(this):void 0},t.prototype.done=function(){var t,n,r;this.isDone=!0,this.id&&(delete o[this.id],e.unlisten(this.id)),r=this.constructor.properties;for(t in r)n=r[t],n.done(this);return e.unbindForTarget(this)},t.prototype.prop=function(t,e){var r;return this.isDone?null:(r=this.constructor.properties,1===arguments.length?r[t]?r[t].getter(this):this[t]:((r[t]||(r[t]=n.instance(t))).setValue(this,e),e))},t.prototype.propertyChanged=function(t){var n;return null!=(n=this[""+t.propId+"Changed"])&&n.call(this,t,t.value),this.id?e.notifyPropertyChanged(this.id,t):void 0},t.prototype.error=function(t,e){return Object.error(t).addPrefix(this).addDetails(e).log()},t.prototype.log=function(t){var e,n;return e=function(){var t,e,r;for(r=[],t=0,e=arguments.length;e>t;t++)n=arguments[t],r.push(n);return r}.apply(this,arguments),e[0]=""+this+": "+t,Object.log.apply(Object,e)},t.prototype.toString=function(){return this.id?"["+this.id+"]":"["+this.constructor.type.id+":"+this._id+"]"},t.applyMixin=function(t,e){var n,i,o,s;if(!t)return this;o=t(s={},e);for(i in o)r.call(o,i)&&(n=o[i],s[i]=this[i]||u,this[i]=n);return this},t.parseMeta=function(t){var e,n;return"string"==typeof t&&(t={id:t}),t.typeId||(e=t.id,n=i.call(e,":")>=0?e.split(":"):[null,e],t.id=n[0],t.typeId=n[1]),t},t.defineType=function(t){var e;return e=t.id.split(" extends "),t.id=e[0],t.superId=e[1],a[t.id]=t},t.getCtor=function(t){return(t=a[t])?t.ctor||(t.ctor=this.createCtor(t)):void 0},t.createCtor=function(){var e,o;return e=["id","superId","properties","methods"],o=function(u){var s,l,c,d,h,p,f;if(u.superId&&o.call(this,a[u.superId]),u.properties)for(f=u.properties,h=0,p=f.length;p>h;h++)c=f[h],this.properties[c]?Object.error("bad-code: Duplicate property "+c+" in type "+u.id).log():(this.properties[(l=n.instance(c)).id]=l).attachToEntityCtor(this);for(s in u)r.call(u,s)&&(d=u[s],i.call(e,s)<0&&(this.options[s]=d));return t.applyMixin.call(this.prototype,u.methods),this},function(n){var u,a,l,c;u=function(t,n){var o,u,a;this.id=t,this._id="E"+s++,this._monitor={},a=this.constructor.options;for(o in a)r.call(a,o)&&(u=a[o],this[o]=u);if(n)for(o in n)r.call(n,o)&&(u=n[o],i.call(e,o)<0&&(this[o]=u));return this},c=t.prototype;for(a in c)r.call(c,a)&&(l=c[a],u.prototype[a]=l);return u.type=n,u.options={},u.properties={},o.call(u,n,{})}}(),t.findUnresolvedType=function(t){var e;return(e=a[t])?e.superId?this.findUnresolvedType(e.superId):null:t},t.resolveType=function(t,e){return Object.event.require(["entity://"+t],function(n){return function(){var r;if(!a[t])throw new Error("Can't resolve type "+t);return(r=n.findUnresolvedType(t))?n.resolveType(r,e):e()}}(this))},t.createInlineCtor=function(t){return this.createCtor({id:"T"+s++,options:t,superId:t.typeId,properties:t.properties||[],methods:t.methods})},t.create=function(t,e){var n,r,i,u;return t=this.parseMeta(t),i=t.typeId,(u=this.findUnresolvedType(i))?this.resolveType(u,function(n){return function(r){return r?void 0:n.create(t,e)}}(this)):(n=t.properties||t.methods?this.createInlineCtor(t):this.getCtor(i),r=new n(t.id,t),r.id&&(o[r.id]=r),r.launch(e),r)},t.get=function(t){return t._id?t:t?o[t]:void 0},t}(),Object.event={create:function(t){return new e(t)},fire:function(t,e){return this.create(t.uri?t:{uri:t}).fire(e)},require:function(t,n){return e.require(t,n)}},Object.entity={define:function(e){return t.defineType(e)},defineProperty:function(t){return n.define(t)},create:function(e,n){return t.create(e,n)}}}.call(this),function(){Object.entity.define({id:"Cache extends EventHandler",uriPattern:"remote://{{host}}/{{path}}?_ver={{version}}",methods:function(){var t;return t={},{resolveUri:function(t){return t=Object.clone(t,t.params),t.path=t.path.join("/"),t.version||(t.version=this.getVersion()),Object.Uri.parse(String.template(this.uriPattern,t))},cacheDeserializer:function(t){return t?"object"==typeof t?t:Object.parse(t):null},cacheSerializer:function(t){return t?(t="object"==typeof t?JSON.stringify(t):t,t&&"{}"!==t?t:null):null},getVersion:function(){return""+(this.version||1)},fetch:function(t,e){return Object.event.fire({uri:this.resolveUri(t),callback:e,unmarshaller:this.fetchUnmarshaller})},restore:function(t){var e,n,r;return(e=null!=(r=this.storage)?r[t]:void 0)?(n=this.getVersion(),n===e.slice(0,+(n.length-1)+1||9e9)?e.slice(n.length+1):null):null},store:function(t,e){var n;try{return null!=(n=this.storage)?n.setItem(t,this.getVersion()+":"+e):void 0}catch(r){}},handleEvent:function(e){var n,r,i;return i=e.uri,n=this.id+":"+i.id,(r=t[n]||(t[n]=this.cacheDeserializer(this.restore(n))))?e.callback(null,r):this.fetch(i,function(r){return function(i,o){var u;return(i=("undefined"!=typeof u&&null!==u?u.error:void 0)||i)&&(i=r.error(i,"fetch data for versioned cache")),!i&&(u=r.cacheSerializer(o))&&(t[n]=o=r.cacheDeserializer(u),r.store(n,u)),e.callback(i,o)}}(this))}}}})}.call(this),function(){Object.entity.define({id:"EventHandler",methods:function(){return{onEvent:function(t){return this.handleEvent(t,t.uri)},handleEvent:function(t){return t.callback(this.error("bad-code: No EventHandler Implementation"))}}}})}.call(this),function(){Object.entity.define({id:"EnumService extends commons.L10nService",methods:function(){var t;return t={},{prepareEnum:function(t){var e,n,r,i;i=[];for(n in t)r=t[n],(e=+n||n)&&("string"==typeof r?i.push({id:e,name:r}):(r.id=e,i.push(r)));return i},onEvent:function(e,n,r){var i;return null==n&&(n=e.uri),null==r&&(r=n.host),(i=t[r])?e.callback(null,i):(i=String.localize.get(r))?(i=this.prepareEnum(i))?e.callback(null,t[r]=i):e.callback("bad-code: enum ["+r+"]"):e.callback("not-found: enum ["+r+"]")}}}}),Object.entity.define({id:"L10nService",properties:["requires:Requires"],requires:[],methods:function(){return{onRequiredLoaded:function(t){var e,n,r,i;if(!t){for(i=[],n=0,r=arguments.length;r>n;n++)e=arguments[n],e&&i.push(String.localize.add(e));return i}},onEvent:function(t){return t.callback(null,String.localize(t.uri.host))}}}})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},e={}.hasOwnProperty;Object.entity.defineProperty({id:"Liquid",methods:function(){return{comparator:function(){return!1}}}}),Object.entity.defineProperty({id:"Boolean",methods:function(){return{comparator:function(t,e){return!t==!e},setter:function(t,e){return t[this.id]=!!e}}}}),Object.entity.defineProperty({id:"Uri",methods:function(){return{comparator:function(t,e){return""+t==""+e},setter:function(t,e){return t[this.id]=Object.Uri.parse(e)}}}}),Object.entity.defineProperty({id:"Number",methods:function(){return{comparator:function(t,e){return Number(t)===Number(e)},setter:function(t,e){return t[this.id]=Number(e)}}},mixin:function(t,e){var n,r;return r={},n=e.id,r["increment"+String.capitalize(n)]=function(t){return null==t&&(t=1),this.prop(n,(this.prop(n)||0)+t)},r}}),Object.entity.defineProperty({id:"Date",methods:function(){return{comparator:function(t,e){return 0===Date.compare(t,e)}}}}),Object.entity.defineProperty({id:"Value",mixin:function(){return{getValue:function(){return this.prop("value")},setValue:function(t){return this.prop("value",t)},isEmptyValue:function(){return!this.getValue()},equalsToValue:function(t){return t&&this.getValue()===""+t}}}}),Object.entity.defineProperty({id:"MultiValue",mixin:function(e){return{valueChanged:function(t,n){this.prop("mvalue",n?n.split&&n.length?n.split(this.mvalueSeparator||","):[""+n]:[]),e.valueChanged.call(this,t,n)},getMultiValue:function(){return this.mvalue||[]},equalsValue:function(e){var n;return e&&(n=""+e,t.call(this.getMultiValue(),n)>=0)},putIntoMultiValue:function(e,n){var r,i,o,u,s,a;if(e){if(u=this.getMultiValue(),e=""+e,i=t.call(u,e)>=0,r=!1,-1===n&&(n=i?0:1),n&&!i&&(u.push(e),r=!0),!n&&i)for(o=s=0,a=u.length;a>s;o=++s)if(e=u[o],e===u[o]){u.splice(o,1),r=!0;break}return r&&this.setValue(u.sort().join(this.mvalueSeparator))}}}}}),Object.entity.defineProperty({id:"Values",methods:function(){return{comparator:function(){return!1}}},mixin:function(t){return{init:function(){return this.storage=this.createStorage(),this.initValue(this.id),t.init.call(this)},createStorage:function(){return this.storage||{getItem:function(t){return this[t]},setItem:function(t,e){return this[t]=e}}},initValue:function(t){var e;return this.prop("value",(e=this.storage.getItem(t))&&Object.parse(e)||this.value||{})},prop:function(e,n){var r;return this.isDone?null:1===arguments.length?"value"===e?this.value:null!=(r=this.value)?r[e]:void 0:"value"===e||"valueUri"===e?t.prop.call(this,e,n):(this.value||(this.value={}),this.value[e]!==n?(this.value[e]=n,this.propertyChanged.call(this,Object.event.create({entity:this,propId:e,value:n,oldValue:this.value[e]}))):void 0)},propertyChanged:function(n){var r,i,o,u,s;if(t.propertyChanged.call(this,n),"valueUri"!==n.propId){if("value"===n.propId){if(r=n.oldValue)for(i in r)e.call(r,i)&&(o=r[i],void 0===(null!=(u=n.value)?u[i]:void 0)&&t.propertyChanged.call(this,Object.event.create({entity:this,propId:i,value:null,oldValue:o})));if(n.value){s=n.value;for(i in s)e.call(s,i)&&(o=s[i],o!==(null!=r?r[i]:void 0)&&t.propertyChanged.call(this,Object.event.create({entity:this,propId:i,value:o,oldValue:null!=r?r[i]:void 0})))}}else this.valuePending||(this.valuePending=!0,Function.nextTick(50,this,function(){return this.valuePending=!1,t.propertyChanged.call(this,Object.event.create({entity:this,propId:"value",value:this.value,oldValue:this.value}))}));return n}},valueChanged:function(e,n){return this.persistValue(n),t.valueChanged.call(this,e,n)},persistValue:function(t){var e;try{if(this.storage.getItem(this.id)!==(e=JSON.stringify(t)))return this.storage.setItem(this.id,e)}catch(n){}}}}}),Object.entity.defineProperty({id:"Requires",mixin:function(t){return{launch:function(e){return Object.event.require(this.requires,function(n){return function(r){var i;return r&&Object.error(r,""+n+".onRequires").log(),"function"==typeof n.onRequiredLoaded&&n.onRequiredLoaded.apply(n,function(){var t,e,n;for(n=[],t=0,e=arguments.length;e>t;t++)i=arguments[t],n.push(i);return n}.apply(n,arguments)),t.launch.call(n,e)}}(this))}}}}),Object.entity.defineProperty({id:"Plugins",mixin:function(t){return{launch:function(e){return Function.perform(this,function(n){return[function(){var t,e,r,i;if(this.plugins)for(i=this.plugins,e=0,r=i.length;r>e;e++)t=i[e],t._parent=this,Object.entity.create(t,n.wait());return n.next()},function(n){var r,i,o,u,s,a,l;for(n&&this.error(n,""+this+".onPluginsInitializing"),this.plugins=function(){var t,e,n;for(n=[],i=t=0,e=arguments.length;e>t;i=++t)r=arguments[i],i>1&&n.push(r);return n}.apply(this,arguments),l=this.plugins,s=0,a=l.length;a>s;s++)u=l[s],(o=u.id)&&(this[o]=u);return t.launch.call(this,e)}]})},done:function(){var e,n,r,i,o;for(t.done.call(this),i=this.plugins,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.done(),e._parent=null,o.push(e.id?this[e.id]=null:void 0);return o}}}})}.call(this),function(){Object.entity.define({id:"HttpService extends EventHandler",defaultHost:window.location.hostname,defaultProtocol:window.location.protocol.slice(0,-1),methods:function(){var t,e,n,r,i;return t=function(t){return t},e={json:"application/json",js:"application/json",html:"text/html",txt:"text/plain"},r=window.XMLHttpRequest||function(){try{return window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}(),n={js:Object.parse,json:Object.parse,uri:Object.parseUri},i=function(){return new r},{negotiateResultType:function(t){var e,n,r;return r=t.path.slice(-1)[0],n="js",r&&(e=r.lastIndexOf("."))>-1&&(n=r.slice(e+1)),n},negotiateError:function(t,e,n){return!t||t>=200&&300>t||304===t?null:Object.error("remote: "+t+" "+n.uri+" "+(e||"")).addDetails(null!=n?n._err:void 0)},resolveMethod:function(t){return t.method||(t.payload?"POST":"GET")},resolveUri:function(t,e){return"*"===t.host&&(t.host=this.defaultHost),t.type=t.params._ssl||e.ssl?"https":this.defaultProtocol,t.params.ssl&&delete t.params._ssl,""+t},onRequestReady:function(e,r){return r.callback(this.negotiateError(e.status,e.statusText,r),(r.unmarshaller||n[r.dataType]||t)(e.responseText))},resolveHeaders:function(t){return Object.update({Accept:e[t.dataType]||"*/*",Language:String.LANGUAGE,"Content-Type":e[t.dataType]},t.headers)},handleEvent:function(e){var n,r,o,u,s,a;try{n=this,u=i(),u.open(this.resolveMethod(e),this.resolveUri(e.uri,e),!0),e._err=new Error,e.dataType||(e.dataType=this.negotiateResultType(e.uri,e)),u.onreadystatechange=function(){return 4!==this.readyState||e.completed||(e.completed=!0,this.onreadystatechange=t,n.onRequestReady(this,e)),!1},a=this.resolveHeaders(e);for(r in a)s=a[r],s&&u.setRequestHeader(r,s);(o=e.uri.params.responseType)&&(u.responseType=o),e.payload?("object"==typeof e.payload&&(u.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.payload=JSON.stringify(e.payload)),u.send(e.payload)):u.send(null)}catch(l){e.callback(this.error("remote_error: "+e.uri,l))}}}}}),Object.entity.define({id:"RawHttpService extends HttpService",methods:function(){return{handleEvent:function(t){var e,n,r,i,o;try{e=this,i=new XMLHttpRequest,t._err=new Error,i.open(this.resolveMethod(t),this.resolveUri(t.uri,t),!0),i.onreadystatechange=function(){var n,r;return 4!==this.readyState||t.completed||(t.completed=!0,this.onreadystatechange=function(t){return t},n=function(){var t,e,n,i;if(this.response){for(n=new Uint8Array(this.response),i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(String.fromCharCode(r));return i}return[]}.call(this),t.callback(e.negotiateError(this.status,this.statusText,t),n.join(""))),!1},r=Object.update({Language:String.LANGUAGE},t.headers);for(n in r)o=r[n],o&&i.setRequestHeader(n,o);i.responseType="arraybuffer",i.send(null)}catch(u){t.callback(this.error("remote_error: "+t.uri,u))}}}}}),Object.entity.define({id:"ScriptService extends HttpService",scriptType:"text/javascript",methods:function(){var t,e,n,r;return e=window._JSONP||(window._JSONP={}),t=window._JSONP_COUNTER||(window._JSONP_COUNTER=1),r=window.document,n=function(t){var e;return e=r.createElement("script"),e.type=this.scriptType,e.charset="utf-8",Object.update(e,t),e},{handleEvent:function(r){var i,o,u,s;return o=n.call(this,r.scriptAttrs),r.noAsynMode||(o.async="async"),r.scriptId&&(o.id=r.scriptId),s=r.uri,r._err=new Error,(i=s.params.jsonp)?(u="n"+t++,s.params[i]=escape("window._JSONP."+u),e[u]=function(t){return"function"==typeof r.callback?r.callback(null,r.unmarshaller?r.unmarshaller(t):t):void 0},o.onload=function(){return o.parentNode.removeChild(o),delete e[u]}):o.onload=function(){var t;return t=r.callback,r.callback=null,"function"==typeof t?t(null,this):void 0},o.onerror=function(){return r.callback(Object.error("remote_error","Script error: "+s))},o.src=this.resolveUri(s,r),Object.dom.appendToHead(o)}}}}),Object.entity.define({id:"EntityService extends ScriptService",scriptType:"text/javascript",methods:function(t){return{resolveUri:function(e,n){return e.path=("js/"+e.host.replace(/\./g,"/")+".js").split("/"),e.host="",t.resolveUri.call(this,e,n)}}}}),function(t){return Object.entity.define({id:"SocketClient",properties:["requires:Requires"],ready:!1,methods:function(e){return{launch:function(t){return this.requires=["script://"+this.channel+"/socket.io.js"],e.launch.call(this,t)
},init:function(){var e,n;if(!(e=t.io))throw new Error("No Socket IO");return n=e.connect(this.channel),n.on("connect",function(t){return function(){return t.onConnect()}}(this)),n.on("message",function(t){return function(e){return t.onMessage(e)}}(this)),n.on("disconnect",function(t){return function(){return t.onDisconnect()}}(this)),this.emit=function(t,e){return null==e&&(e=t.callback),t.uri=""+t.uri,delete t.callback,n.json.emit("message",t,e)}},handleEvent:function(t){return this.log("send",t),this.emit(t)},onConnect:function(t){return this.log("onConnect",t),e.init.call(this)},onDisconnect:function(t){return this.log("onDisconnect",t)},onMessage:function(t){return this.log("onMessage",t),t.uri?Object.event.fire(t):void 0}}}})}(this),Object.entity.define({id:"HtmlLoader extends Cache",uriPattern:"remote://*/html/{{host}}.html",methods:function(t){return{init:function(){return this.storage=this.createStorage(),t.init.call(this)},createStorage:function(){return this.storage||{getItem:function(t){return this[t]},setItem:function(t,e){return this[t]=e}}},cacheDeserializer:function(t){return t},cacheSerializer:function(t){return t}}}}),Object.entity.define({id:"CodeLoader extends Cache",uriPattern:"remote://*/js/{{host}}.js?_ver={{version}}",methods:function(){return{fetchUnmarshaller:function(t){return t},cacheSerializer:function(t){return this.evaluate(t)},cacheDeserializer:function(t){return this.evaluate(t)},evaluate:function(t){if(!t)return null;try{Function.call(Function,t)()}catch(e){this.error(e,"JS syntax:"+e.message).log()}return t}}}}),Object.entity.define({id:"EntityLoader extends CodeLoader",methods:function(t){return{resolveUri:function(e){return e.host=e.host.replace(/\./g,"/"),t.resolveUri.call(this,e)}}}}),Object.entity.define({id:"Settings",properties:["value:Values"],storage:window.localStorage}),Object.entity.define({id:"webclient.HashNavigator",properties:["page","index","value:Values"],methods:function(t){var e,n;return e=window.location,n=function(t){var e,n,r,i,o,u;if(t&&"#"!==t||(t="#!home"),i={page:"",index:"",index1:""},"!"===t[1])for(n=t.slice(2).split("~"),i.page=n[0],r=o=0,u=n.length;u>o;r=++o)e=n[r],r>0&&(i["index"+(r-1||"")]=e||"");return i},{init:function(){return t.init.call(this),window.onhashchange=function(t){return function(){return t.initValue()}}(this)},initValue:function(){return this.prop("value",n(e.hash))},valueChanged:function(t,n){var r,i,o;if(n){for(i=[],r=n.page,o=0;r;)i.push(r),r=n["index"+(o||"")],o++;return(i="#!"+i.join("~"))!==e.hash?e.hash=i:void 0}}}}}),Object.entity.define({id:"webclient.Application",properties:["title","plugins:Plugins"],doc:window.document,domNode:window.document.body,methods:function(t){return{init:function(){var e,n,r,i,o;for(t.init.call(this),i=this.domNode.querySelectorAll("[data-widget]"),o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(Object.dom.initWidget({domNode:e,_parent:this}));return o},titleChanged:function(t,e){return this.doc.title=e}}}})}.call(this),function(){var t=[].slice;!function(e){var n,r,i,o,u,s,a,l,c,d,h,p,f,v,m;return n=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB,i=e.IDBKeyRange||e.webkitIDBKeyRange,r=e.IDBCursor||e.webkitIDBCursor||e.mozIDBCursor||e.msIDBCursor,u=r.PREV||"prev",o=r.NEXT||"next",s=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},a=function(){return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s()},m=function(e){var n,r,s,a;return n=e.descend||"desc"===e.dir,(s=e.range)?s instanceof Array?(r=s[0],a=s[1],null===a?[i.lowerBound(r)]:null===r?[i.upperBound(a)]:(n=r>a)?[i.apply(null,t.call([a,r]).concat([u]))]:[i.apply(null,t.call([r,a]).concat([o]))]):[i.only(s)]:[null,n?u:o]},v=function(t,e){var n,r,i;if(i=e.id)return t.get(i);for(r in t.indexNames)if(n=t.index(r),i=e[n.keyPath])return n.get(i);return null},f=function(){var t,e;return e=function(t){return t.keyPath?t:{keyPath:t}},t=function(t,n,r){var i,o,u,s;for(null==n&&(n="id"),null==r&&(r=[]),i=this.createObjectStore(t,e(n)),s=[],o=0,u=r.length;u>o;o++)n=r[o],(n=e(n))&&s.push(i.createIndex(String.camelize(n.keyPath,","),n.keyPath,n.options));return s},function(e){var n,r,i,o,u,s,a,l,c,d;for(this.log("Upgrade",e.oldVersion," => ",e.newVersion),n=e.target.result,l=n.objectStoreNames,o=0,s=l.length;s>o;o++)r=l[o],n.deleteObjectStore(r);if(!this.scheme)throw new Error("No scheme for db "+this.id);for(c=this.scheme,d=[],u=0,a=c.length;a>u;u++)i=c[u],(i=i.id?i:{id:i})&&d.push(t.call(n,i.id,i.keyPath,i.indices));return d}}(),p=function(){var t,e;t="query"===(e=this.operation)||"read"===e?"readonly":"readwrite";try{return this.store=this.home.db.transaction(this.scope||[this.storeId],t).objectStore(this.storeId),this.next()}catch(n){return this.callback(this.home.error("db","can't obtain the store "+this.storeId,n))}},l=function(t,e,n){var r,i,o,u,s,a;return null==e&&(e={}),o=e.key,a=o?t.index(String.camelize(o,",")):t,(r=a.openCursor.apply(a,m(e)))?(r.onerror=function(t){return n(Object.error("failed","cursor error",t))},i=[],s=0,u=0,r.onsuccess=function(t){return(r=t.target.result)?(e.limit&&u>=e.limit?(n(null,i),t.target.transaction.abort()):e.offset&&e.offset>s?(s++,r["continue"]()):(i.push(r.value),u++,r["continue"]()),0):n(null,i)},0):n("No cursor")},c=function(){var t,e;return t=this.next,(e=v(this.store,this.options))?(e.onsuccess=function(e){var n,r;return(n=e.target.result)||(r="not_found"),t(r,n)},e.onerror=function(){return t("not_found")},0):t("not_specified")},h=[function(){var t,e;return t=[].concat(this.payload),(e=function(n){return function(){var r,i;return(r=t.shift())?(r.id||(r.id=a()),r.ts=Date.now().valueOf(),i=n.store.put(r),i.onsuccess=e,i.onerror=n.next):n.next()}}(this))()},function(){return this.home.prop("touch",Date.now()),this.next()}],d={query:function(){return l(this.store,this.options,this.next)},find:c,field:[c,function(t,e){return this.next(t,null!=e?e[this.options.field]:void 0)}],insert:h,update:h,upsert:h,remove:function(){var t;return t=store["delete"](this.payload[0].id),t.oncomplete=this.next,t.onerror=function(t){return function(){return t.next("Not Deleted")}}(this)},clear:function(){var t;return t=store.clear(),t.oncomplete=this.next,t.onerror=function(t){return function(){return t.next("Not cleared")}}(this)},sync:function(){var t;return(t=this.prop("syncDeltaUri"))?this.prop("syncDeltaUri",t):void 0}},Object.entity.define({id:"IndexedDatabase extends EventHandler",properties:["touch","sync"],version:1,methods:function(t){return{launch:function(r){var i;return i=n.open(this.id,this.version),i.onblocked=function(t){return function(){return t.error("db","blocked")}}(this),i.onerror=function(t){return function(e){return t.error("db","couldn't not connect",e)}}(this),i.onabort=function(t){return function(e){return t.error("db","connection aborted",e)}}(this),i.onsuccess=function(e){return function(n){return e.db=n.target.result,t.launch.call(e,r)}}(this),i.onupgradeneeded=function(n){return function(i){var o;return null!=(o=e.localStorage)&&(o[n.id+"LastSync"]=0),f.call(n,i,function(){return t.launch.call(n,r)})}}(this)},init:function(){var n;return t.init.call(this),this.prop("lastSynchedTimestamp",null!=(n=e.localStorage)?n[this.id+"LastSync"]:void 0),this.socketChannel?Object.entity.create({id:this.id+"Socket:SocketClient",channel:this.socketChannel}):void 0},done:function(){var e;return null!=(e=this.db)&&e.close(),t.done.call(this)},handleEvent:function(t,e){return t.home=this,t.storeId=e.path[0].toLowerCase(),t.operation=e.host,t.payload=t.docs||[t.doc],t.options=Object.update(e.params,t.options),Function.perform(t,function(t){return this.next=t.next,[p].concat(d[this.operation],this.callback)})},syncChanged:function(t,e){return e?Function.perform(this,function(t){return[function(){var n,r;for(r in e)n=e[r],(r=r.split("_")[0])&&Object.event.fire({uri:"db://upsert/"+r,docs:n,callback:t.wait()});return t.next()},function(){return this.prop("lastSynchedTimestamp",this._newSyncTs)}]}):this._newSyncTs=Date.now()},lastSynchedTimestampChanged:function(t,n){var r,i;return null!=(i=e.localStorage)&&i.setItem(this.id+"LastSync",n),this.syncPeriod?(r=function(t){return function(){return t.prop("lastSynchedTimestampByPeriod",n)}}(this),e.setTimeout(r,this.syncPeriod)):this.prop("lastSynchedTimestampOnce")?void 0:this.prop("lastSynchedTimestampOnce",n)}}}})}(this)}.call(this),function(){Object.entity.defineProperty({id:"SubmitSupport",mixin:function(){var t;return t=/~/g,{validateFields:function(){var t,e,n,r,i,o,u,s;if(t={stack:[]},i=!0,this.fields){for(s=this.fields,o=0,u=s.length;u>o;o++)n=s[o],e=Object.entity.get(n).checkIfValid(),e.stack.length&&t.stack.push.apply(t.stack,e.stack);(i=!t.stack.length)||((r=t.stack[0].entity.valueElt)&&r.domNode.focus(),this.error(t))}return i},fieldsValues:function(){var e,n,r,i,o,u,s,a;if(n={},this.fields)for(s=this.fields,r=0,o=s.length;o>r;r++)e=s[r],Object.prop(n,e.replace(t,"."),Object.entity.get(e).getValue());if(this.inputs)for(a=this.inputs,i=0,u=a.length;u>i;i++)e=a[i],Object.prop(n,e.replace(t,"."),window.document.getElementById(e).value);return n},getFields:function(){var t,e,n,r,i;if(e={},this.fields)for(i=this.fields,n=0,r=i.length;r>n;n++)t=i[n],e[t]=Object.entity.get(t);return e},create_onload_handler:function(){var t;return t=this,function(){var e,n,r,i,o;if(t.frameElt&&(r=t.frameElt.domNode,e=r.contentDocument,o=r.contentWindow||e.window||r,"about:blank"!==o.location.href))return n=null,i=Object.parse(e.body.innerText||e.body.textContent||e.body.innerHTML),i||(i={errors:[{reason:"server_error"}]}),i.errors&&i.errors.length&&(n={stack:i.errors}),t.onResult(n,i)}},onResult:function(t,e){return t?this.error(t):this.success(e)},error:function(t){return Object.dom.handleError(t,this)},success:function(t){return t}}}}),Object.entity.define({id:"AsyncButton extends Button",properties:["support:SubmitSupport"],busyCaption:"in_progress",methods:function(){return{createAsyncDoc:function(){return this.fieldsValues()},async:function(){return this.validateFields()&&this.createAsyncEvent()},createAsyncEvent:function(){return{uri:this.asyncUrl,doc:this.createAsyncDoc(),callback:this.createAsyncCallback()}},createAsyncCallback:function(){return this.onResult}}}}),Object.entity.define({id:"Form extends Box",properties:["disabled:Disabled","support:SubmitSupport","value:Values"],domNodeType:"form",domNodeAttrs:{onsubmit:function(){return!1}},submit:function(){return this.domNode.submit()}}),Object.entity.define({id:"SubmitForm extends Form",enctype:"application/x-www-form-urlencoded",method:"post",action:"#",methods:function(t){return{init:function(){var e,n;return e=this,n=this.id,this.domNode||(this.domNode=Object.dom.createComplexElement(String.format('<form enctype="{0}" method="{1}" target="{2}_target" action="{3}"></form>',this.enctype,this.method,this.id,this.action),this.domNodeAttrs)),Object.dom.listenEvents(this,"submit",function(){return e.validateFields()}),t.init.call(this),this.createChild({id:n+"_target:View",onInited:function(){return e.frameElt=this},domNode:Object.dom.createComplexElement('<iframe src="about:blank" style="display:none;" name="'+this.id+'_target"></iframe>')},function(t,e){e&&Object.dom.listenEvents(e,"load",this.create_onload_handler())})},childrenAdapter:function(t){return[].concat(t)}}}}),Object.entity.define({id:"SubmitButton extends View",methods:function(t){return{init:function(){return this.domNode=Object.dom.createComplexElement('<input type="submit"/>',{value:String.localize(this.caption)}),t.init.call(this)}}}}),Object.entity.define({id:"FileContent extends Field",methods:function(t){return{childrenAdapter:function(e){var n;return t.childrenAdapter.call(n=this,[{id:this.id+"_input:View",onInited:function(){return n.valueElt=this},domNode:Object.dom.createComplexElement(String.format('<input type="file" class="{0}" name="{1}"/>',this.valueStyle,this.fileFieldName||this.id),{onchange:this.create_onchange_handler()})}].concat(e))},create_onchange_handler:function(){return function(t){return function(e){var n,r,i,o,u;for(u=e.target.files,i=0,o=u.length;o>i;i++)return n=u[i],r=new FileReader,r.onload=function(e){return t.prop("file",n),t.prop("value",e.target.result)},void r.readAsBinaryString(n)}}(this)}}}}),Object.entity.define({id:"FileUploader extends Field",properties:["attempt","submitSupport:SubmitSupport"],methods:function(t){return{init:function(){this.domNode||(this.domNode=Object.dom.createComplexElement(String.format('<form enctype="multipart/form-data", method="post" target="{0}_target" action="{1}"></form>',this.id,this.action),this.domNodeAttrs)),t.init.call(this),Object.dom.listenEvents(this.frameElt,"load",this.create_onload_handler())},childrenAdapter:function(e){var n,r;return n=this,r=this.id,t.childrenAdapter.call(this,[{id:r+"_input:View",onInited:function(){return n.valueElt=this},domNode:Object.dom.createComplexElement(String.format('<input type="file" class="{0}" name="{1}"/>',this.valueStyle,this.fileFieldName||r),{onchange:this.create_onchange_handler()})},{id:r+"_link:View",onInited:function(){return n.linkElt=this},domNodeType:"a",domNodeAttrs:{target:"_blank"}},{onInited:function(){return n.frameElt=this},id:r+"_target:View",domNode:Object.dom.createComplexElement('<iframe src="about:blank" style="display:none;" name="'+this.id+'_target"></iframe>',{onload:this.create_onload_handler()})}].concat(e))},submit:function(){var t;return"function"==typeof(t=this.domNode).submit?t.submit():void 0},create_onchange_handler:function(){return function(){return!0}},error:function(e){return e.alertEntity=this.linkElt,t.error.call(this,e)},success:function(t){var e,n;return n=""+(t&&t.uri||""),n&&(e=this.linkElt.domNode,e.className="",e.innerHTML="link",this.setValue(e.href="//"+n)),this.prop("attempt",1+this.prop("attempt"))}}}}),Object.entity.define({id:"Field extends Box",properties:["caption:Caption","value:Value","disabled:Disabled","hint"],children:[],caption:"",style:"form-group",valueBoxStyle:"form-input-container",valueStyle:"form-control",captionStyle:"control-label",methods:function(t){return{init:function(){var e;return this.caption=this.caption||(null!=(e=this.id)?e.split(".")[-1]:void 0),t.init.call(this)},childrenAdapter:function(t){var e;return e=this,(null!=t?t.length:void 0)||(t=[{id:this.id+"_input:View",onInited:function(){return e.valueElt=this},style:this.valueStyle,tapped:function(t){return e.doFocus(t)}}]),[{id:this.id+"_label:Label",onInited:function(){return e.captionElt=this},domNode:Object.dom.createComplexElement(String.format('<label class="{0}" for="{1}_input"/>',this.captionStyle,this.id))},{id:"Box",style:this.valueBoxStyle,children:t}]},launchEditor:Function.NONE,doFocus:function(t){this.launchEditor(t)},isEditable:function(){return!this.readOnly},valueChanged:function(){this.redrawValue()},redrawValue:function(){this.valueElt&&(this.valueElt.domNode.innerHTML=this.getCValue()),this.domNodeClass("!error")},doneEditor:function(t){var e;e=t.value,e!==this.getValue()&&(t.fromUI=!0,t.isEvent=!0,this.setValue(t))},addValidationRule:function(t){this.rules=(this.rules||[]).concat(t)},checkIfValid:function(){var t,e,n,r,i,o,u,s,a,l;if(e={stack:[]},this.isValueRequired()&&this.isEmptyValue()&&e.stack.push({reason:"empty_required_field",message:String.localize("empty_required_field",String.localize(this.caption||this.id))}),rules)for(a=this.rules,i=0,u=a.length;u>i;i++)n=a[i],n.call(this,e);if(r=!e.stack.length,!r)for(l=e.stack,o=0,s=l.length;s>o;o++)t=l[o],t.entity=this;return this.toggleDomNodeClass("error",!r),e},isValueRequired:function(){return this.valueRequired},getCValue:function(){return this.getValue()},getCaptionHtml:function(t){return String.localize(t||this.id)+(this.valueRequired?' <span class="required">*</span>':"")},disabledChanged:function(e,n){return t.disabledChanged.apply(this,arguments),Object.prop(this,"valueElt.domNode.disabled",n)},hintChanged:function(t,e){var n;return null!=(n=this.hintElt)?n.prop("caption",e):void 0}}}}),Object.entity.define({id:"Input extends Field",alive:!0,maxLength:128,inputTag:"input",inputType:"text",methods:function(t){return{childrenAdapter:function(e){return e=this.getInputChildrenMeta(),t.childrenAdapter.call(this,e)},getInputChildrenMeta:function(){var t;return t=this,[{id:this.id+"_input:View",domNode:this.create_inputNode(),style:this.valueStyle,onInited:function(){return t.valueElt=this}}]},create_inputNode:function(){var t;return t=this.create_onblur_handler(),Object.dom.createComplexElement(String.format('<{0} type="{1}" name="{2}" maxLength="{3}"/>',this.inputTag,this.inputType,this.id,this.maxLength),Object.update({placeholder:String.localize(this.placeholder),onblur:t,onfocusleave:t,onkeydown:this.create_onkeydown_handler()},this.inputNodeAttrs))},create_onblur_handler:function(){var t;return t=this,function(){return t.doneEditor({value:this.value}),!0}},create_onkeydown_handler:function(){var t;return t=this,function(e){return e=e||window.event,13===e.keyCode&&t.doneEditor({value:this.value}),!0}},redrawValue:function(){var t;return null!=(t=this.valueElt)&&(t.domNode.value=this.getValue()),this.domNodeClass("!ui-error")},tapped:function(){var t;return null!=(t=this.valueElt)?t.domNode.focus():void 0},hintChanged:function(t,e){var n;return null!=(n=this.valueElt)?n.domNode.placeholder=e:void 0}}}}),Object.entity.define({id:"Textarea extends Input",inputTag:"textarea",maxLength:8192}),Object.entity.define({id:"PasswordInput extends Input",inputType:"password"}),Object.entity.define({id:"DateInput extends Input",inputType:"date"}),Object.entity.define({id:"Dropdown extends Input",properties:["data"],dataIdKey:"id",methods:function(t){var e;return e=function(t,e,n){return null==e&&(e=""+t),null==n&&(n=!1),new Option(e,t,n,n)},{getInputChildrenMeta:function(){var t;return t=this,[{id:this.id+"_input:View",onInited:function(){return t.valueElt=this},domNodeType:"select",style:this.valueStyle,domNodeAttrs:{onchange:this.create_onchange_handler()}}]},tapped:function(){var t;return null!=(t=this.valueElt)?t.domNode.focus():void 0},create_onchange_handler:function(){var t;return t=this,function(){return t.doneEditor({value:this.selectedIndex?t.data[this.selectedIndex-1][t.dataIdKey]:""}),!0}},dataChanged:function(n,r){var i,o,u,s,a,l,c;if(t.dataChanged.call(this,n,r),a=this.valueElt.domNode.options,a.length=0,null===r)a[0]=e("","Loading...");else for(a[0]=e("","",!this.value),o=l=0,c=r.length;c>l;o=++l)i=r[o],(u=i[this.dataIdKey])&&(s=u===this.value,this.valueElt.domNode.options[o+1]=e(u,i.name,s),s&&this.prop("datum",i));return n},redrawValue:function(){var t,e,n,r,i,o;if(this.data)for(o=this.data,e=r=0,i=o.length;i>r;e=++r)if(t=o[e],(n=t[this.dataIdKey])===this.value)return this.prop("datum",t),void(this.valueElt.domNode.selectedIndex=e+1);return this.valueElt.domNode.selectedIndex=0}}}}),Object.entity.define({id:"Checkbox extends Field",captionStyle:"checkbox",childrenAdapter:function(){var t,e;return t=this,e=function(){return t.doneEditor({value:!!this.checked}),!0},[{id:"Box",style:this.valueBoxStyle,children:[{id:"View",onInited:function(){return t.valueElt=this},domNodeType:"input",style:this.valueStyle1,domNodeAttrs:{onchange:e,type:"checkbox",value:!0,disabled:this.disabled,checked:!!this.getValue()}},{id:"View",onInited:function(){return t.captionElt=this},domNodeType:"span",css:"display:inline;padding-left:8px"}]}]},redrawValue:function(){this.valueElt&&(this.valueElt.domNode.checked=!!this.getValue())}}),Object.entity.define({id:"Fieldset extends Box",domNodeType:"fieldset",childrenAdapter:function(t){return t.unshift({id:this.id+"_label:Label",domNodeType:"legend",style:this.captionStyle,caption:this.caption}),t}})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Object.dom=function(e){var n,r,i,o;return o=e.document,i=function(t){var n,r;if(r={},n=void 0,e.event)r.internal=e.event,r.target=n=e.event.srcElement;else{for(r.internal=t,n=t.target;n&&1!==n.nodeType;)n=n.parentNode;r.target=n}for(;n&&!n.entity;)n=n.parentNode;return r.entity=n&&n.entity,r},n=["mousedown","mouseup","click","mousemove","mouseover","mouseout"],r=function(t){var e,n,r;if(e=this,!e.disabled)switch(n=i(t),r=n.internal.type){case"mousedown":e.stylePressed&&e.updateClass(e.stylePressed),e.touchBegin&&e.touchBegin(n);break;case"mouseup":e.touchEnd&&e.touchEnd(n),e.stylePressed&&e.updateClass("!"+e.stylePressed);break;case"click":e.tapped&&e.tapped(n);break;case"mousemove":e.mouseMove&&e.mouseMove(n);break;case"mouseover":e.styleHovered&&e.updateClass(e.styleHovered),e.mouseOver&&e.mouseOver(n);break;case"mouseout":e.mouseOut&&e.mouseOut(n),e.styleHovered&&e.updateClass("!"+e.styleHovered)}return!0},{document:e.document,createEvent:i,STYLE_LINE_FIXED:"overflow:hidden;white-space:nowrap;cursor:pointer;",STYLE_TEXTLINE:"white-space:nowrap;line-height:1.5em;vertical-align:middle;",createElement:function(t,e){return null==t&&(t="DIV"),Object.update(o.createElement(t),e)},createComplexElement:function(t,e){var n,r;return n=this.DOM_FACTORY||(this.DOM_FACTORY=o.createElement("div")),n.innerHTML=t,r=n.firstChild,n.removeChild(r),Object.update(r,e)},appendToHead:function(t){var e;return e=o.getElementsByTagName("head")[0],e.appendChild(t)},appendCss:function(t){return this.appendToHead(this.createElement("link",{rel:"stylesheet",href:t}))},getElementById:function(t){return o.getElementById(t)||null},removeElement:function(t){var e;return null!=t&&null!=(e=t.parentNode)?e.removeChild(t):void 0},alive:function(t){return this.listenEvents(t,n,function(e){return r.call(t,e)})},listenTapped:function(t){return this.listenEvents(t,["click"],function(e){return r.call(t,e)})},listenEvents:function(t,e,n,r){var i,u,s,a;for(u=t?t.domNode:o,i=e.split?e.split(" "):e,s=0,a=i.length;a>s;s++)e=i[s],u.addEventListener?u.addEventListener(e,n,r):u.attachEvent("on"+e,n,r);return u},stopEvent:function(t){return(t=(null!=t?t.internal:void 0)||t)&&("function"==typeof t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1),!1},isKeyboardCode:function(t,n){return null==t&&(t=e.event||{}),t.keyCode===n||t.charCode===n||t.which===n},KEY_CODE:{ESCAPE:27,ENTER:13,TAB:8},viewportSize:function(){var t;return t=e.screen,{width:t.availWidth,height:t.availHeight}},getTotalOffset:function(t){var e;for(e={top:0,left:0,width:t.clientWidth,height:t.clientHeight};t;)e.top+=t.offsetTop-t.scrollTop,e.left+=t.offsetLeft-t.scrollLeft,t=t.offsetParent;return e},getDataset:function(t){var e,n,r,i,o,u;if(n=t.dataset)return n;for(n={},u=t.attributes,i=0,o=u.length;o>i;i++)e=u[i],"data-"===(r=e.name).slice(0,5)&&(n[String.camelize(r.slice(5),"-")]=t.getAttribute(r));return n},handleError:function(t){return Object.error(t).log()},updateClass:function(e,n){var r,i,o,u,s;if(!e||!n)return e;for(i=e.className.split(" "),n=n.split(" "),u=0,s=n.length;s>u;u++)r=n[u],r&&("!"===r[0]?"!*"===r?i=[]:(o=i.indexOf(r.slice(1)))>-1&&(i[o]=""):t.call(i,r)<0&&i.push(r));return e.className=function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)r=i[t],r&&n.push(r);return n}().join(" "),e},initWidget:function(){var t;return t=function(t,e){var n;return Object.error(t("wrong_widget",e)).log(),n=Object.dom.createElement(),e.domNode.appendChild(n),Object.entity.create({typeId:"Html",parentView:e.parentView,style:"alert-error",html:"Error: "+(t.message||"can't create UI view: "+e.id)})},function(e){var n,r,i,o,u;n=e.domNode,u=Object.dom.getDataset(n);for(i in u)o=u[i],e[i]=o;return r=n.getAttribute("id"),e.id=(r?r+":":"")+e.widget,Object.entity.create(e,function(n,r){var i,o;return n?t(n,e):null!=(i=e.parentView)&&null!=(o=i._subs)?o.push(r):void 0})}}()}}(this),Object.entity.defineProperty({id:"Node",methods:function(){return{init:function(t,e){var n,r,i,o;return(r=e.domNode)||(n={},t.id&&(n.id=t.id),r=Object.dom.createElement(t.domNodeType,Object.update(n,t.domNodeAttrs))),t.domNode=t.contentNode=r,r.entity=t,(null!=(i=r.parentNode)?i.parentNode:void 0)||(t.domNodeNextSibling?t.domNodeNextSibling.parentNode.insertBefore(r,t.domNodeNextSibling):null!=(o=t.parentView)&&o.contentNode.appendChild(r)),t.tapped&&Object.dom.listenTapped(t),t.propertyChanged(Object.event.create({entity:t,propId:this.id,value:t.domNode}))},done:function(t){var e;return(e=t.domNode)?(Object.dom.removeElement(e),e.entity=null,t.domNode=null,t.contentNode=null):void 0}}}}),Object.entity.defineProperty({id:"Style",methods:function(){return{init:function(t,e){var n;return n=t.domNode,t.css&&(n.style.cssText+=t.css),e.styleExpression&&Object.property.bind(t,this.id,e.styleExpression),t.domNodeClass((e.style||"")+" "+(n.className||""))},getter:function(t){return t.domNode.className},setter:function(t,e){return"string"==typeof e?t.domNodeClass(e):t.domNodeStyle(e)}}},mixin:function(){return{domNodeStyle:function(t){var e,n,r;if(!(n=this.domNode.style)||!t)return n;for(e in t)r=t[e],n[e]!==r&&(n[e]=r);return n},domNodeClass:function(t){return Object.dom.updateClass(this.domNode,t)},toggleDomNodeClass:function(t,e){return Object.dom.updateClass(this.domNode,e?t:"!"+t)}}}}),Object.entity.defineProperty({id:"Hidden",methods:function(){return{getter:function(t){return"none"===t.domNode.style.display},setter:function(t,e){return t.toggleDomNodeClass("hidden",e),t.domNode.style.display=e?"none":this.displayType||""}}},mixin:function(){return{display:function(t,e){var n;if(this.setHidden(!t),t&&e&&(n=this))for(;n=n.parentView;)n.display(t);return this},switchDisplay:function(){return this.setHidden(!this.isHidden())},isHidden:function(){return this.prop("hidden")},setHidden:function(t){return this.prop("hidden",t)}}}}),Object.entity.defineProperty({id:"Caption",methods:function(){return{setter:function(t,e,n){var r,i;if(null==e&&(e=""),t[this.id]=e,r=t.getCaptionElt(),i="none"===e,r){r.display(!(r.hidden||i)),e=t.getCaptionHtml(e,n);try{return r.domNode.innerHTML=i||!e?"":e}catch(o){return t.error(o,"Caption")}}},comparator:function(){return!1}}},mixin:function(){return{getCaptionElt:function(){return this.captionElt||this},getCaptionHtml:function(t,e){var n;return((n=this.prop("icon"))?'<i class="icon-#{icon}"></i> ':"")+String.localize(t,e.quantity)}}}}),Object.entity.defineProperty({id:"Html",methods:function(t){return{setValueAsync:function(e,n,r){return this.setter(e,e.asyncPlaceholder||null,n),t.setAsyncValue.call(this,e,n,r)},getter:function(t){var e;return null!=(e=t.contentNode)?e.innerHTML:void 0},setter:function(t,e){var n;null==e&&(e="<div>&nbsp;</div>");try{if(null!=e?e.error:void 0)throw e.error;return t.contentNode.innerHTML=e}catch(r){return n=String.localize("html_error")+": "+r.message,t.contentNode.innerHTML="<div style='color:red;'>"+n+"</div>"}}}}}),Object.entity.defineProperty({id:"Disabled",methods:function(){return{setter:function(t,e){return t[this.id]=!!e},comparator:function(t,e){return!t==!e}}},mixin:function(t){return{init:function(){return t.init.call(this),Object.dom.alive(this)},disabledChanged:function(t,e){return this.domNode.disabled=e?"disabled":"",this.toggleDomNodeClass("disabled",e)}}}}),Object.entity.define({id:"View",properties:["domNode:Node","style:Style","hidden:Hidden"]}),Object.entity.define({id:"Html extends View",properties:["html:Html"]}),Object.entity.define({id:"Widget extends Html",properties:["data","template"],methods:function(t){var e;return e=function(){var t,e,n,r;if(this._subs)for(r=this._subs,e=0,n=r.length;n>e;e++)t=r[e],t.done();return this._subs=[]},{done:function(){return e.call(this),t.done.call(this)},htmlChanged:function(){var t,n,r,i,o;for(e.call(this),i=this.domNode.querySelectorAll("[data-widget]"),o=[],n=0,r=i.length;r>n;n++)t=i[n],o.push(Object.dom.initWidget({domNode:t,parentView:this}));return o},templateChanged:function(){return this.redraw()},dataChanged:function(){return this.redraw()},redraw:function(){var t,e;if((e=this.prop("template"))&&(t=this.prop("data")))return this.prop("html",String.template(e,t))}}}}),Object.entity.define({id:"Label extends View",properties:["caption:Caption"],domNodeType:"span"}),Object.entity.define({id:"Button extends View",properties:["disabled:Disabled","caption:Caption","counter"],domNodeType:"button",counter:0,methods:function(){return{tapped:function(t){return this.prop("disabled",!0),(t=this.createAsyncEvent())?(this.domNodeClass("ui-busy"),this.busyCaption&&(this.savedCaption=this.prop("caption"),this.prop("caption",this.busyCaption)),Object.event.fire(t,function(e){return function(n,r){return"function"==typeof t.callback&&t.callback(n,r),n||e.incrementCounter(),e.domNodeClass("!ui-busy"),e.prop("disabled",!1),e.savedCaption?(e.prop("caption",e.savedCaption),e.savedCaption=null):void 0}}(this))):(this.incrementCounter(),Function.nextTick(function(t){return function(){return t.prop("disabled",!1)}}(this)))},createAsyncEvent:function(){return this.action?{uri:this.action}:null},incrementCounter:function(){return this.prop("counter",this.prop("counter")+1)},counterChanged:function(){return this.prop("odd",!this.prop("odd"))}}}}),Object.entity.defineProperty({id:"Children",methods:function(t){var e;return e=function(t,e){return"string"==typeof t&&(t=Object.entity.create.parseMeta(t)),t=Object.update({id:"box",parentView:this},t),Object.entity.create(t,e)},{createAsyncValueCallback:function(t){return function(e){return function(n,r){return t._done?void 0:(t.domNodeClass("!ui-busy"),t.prop(e.id,t.childrenAsyncAdapter(n,r)))}}(this)},setValueForUri:function(e,n){return e.domNodeClass("ui-busy"),t.setValueForUri.call(this,e,n)},setValue:function(t,n){return(null!=n?n.isEvent:void 0)||(n=Object.event.create({value:n})),n.uri&&this.setValueForUri(t,n.uri),Function.perform(t,function(t){return[function(){var r,i,o,u,s,a;if(o=this.childrenAdapter(n.value,n),n.noReset||this.removeAllChildren(),r=this.getChildren(),u=function(n){return function(i){var o,u;return u=r.length,r.push(null),o=t.wait(),e.call(n,i,function(t,e){return r[u]=e,o(t,e)})}}(this),o)for(s=0,a=o.length;a>s;s++)i=o[s],i&&u.call(this,i);return t.next()},function(){var t,e,n;return n=function(){var n,r,i;for(i=[],e=n=0,r=arguments.length;r>n;e=++n)t=arguments[e],e>1&&i.push(t);return i}.apply(this,arguments),this.childrenChanged({value:n},n)}]})},done:function(e){return e.removeAllChildren(),t.done.call(this,e)}}},mixin:function(){return{createChild:function(t,e){return _child.call(this,t,function(t){return function(n,r){var i;return i=t.getChildren(),i.push(r),"function"==typeof t.childrenChanged&&t.childrenChanged({value:i},i),"function"==typeof e?e(n,r):void 0}}(this))},childrenAdapter:function(t){return t},childrenChanged:function(t){return t},getChildren:function(){return this._children||(this._children=[])},removeAllChildren:function(){var t,e,n,r;if(this._children)for(r=this._children,e=0,n=r.length;n>e;e++)t=r[e],t.done();return this._children=[]},setChildren:function(t){return this.prop("children",t)},childrenAsyncAdapter:function(t,e){return t?{id:"Html",html:String.localize(t.reason||"unknown_error")}:e}}}}),Object.entity.define({id:"Box extends View",properties:["children:Children"]}),Object.entity.define({id:"List extends View",properties:["children:Children","itemTemplate","data","selection","value:Value"],style:"list-group",domNodeType:"ul",itemType:"Widget",itemStyle:"list-group-item",itemTemplate:'<a href="#" onclick="return false;">{{name}}</a>',dataIdKey:"id",itemDomNodeType:"li",asyncDataPropertyName:null,itemActiveStyle:"active",methods:function(){var t;return t=function(t,e,n){var r,i,o,u;if(null==n&&(n={}),t)for(o=0,u=t.length;u>o;o++)r=t[o],(i=r[e]||(r[e]=Object.math.uuid()))&&(n[i]=r);return n},{valueChanged:function(t,e){var n;return this.prop("datum",null!=(n=this.dataRegistry)?n[e]:void 0),this.syncSelection()},itemTemplateChanged:function(t,e){var n,r,i,o;i=this.childrenRegistry,o=[];for(r in i)n=i[r],o.push(n.prop("template",e));return o},childrenChanged:function(){return this.childrenRegistry=t(this.getChildren(),"value"),this.syncSelection()
},dataChanged:function(e,n){var r;return n?this.prop("dataCount",n.length):(this.prop("dataCount",e.error?-2:-1),n=[]),this.dataRegistry=t(n,this.dataIdKey),this.childrenRegistry={},this.setChildren(n),this.dataCount>=0&&(r=this.getValue())&&!this.dataRegistry[r]?this.prop("value",null):void 0},syncSelection:function(){var t;return this.prop("selection",null!=(t=this.childrenRegistry)?t[this.getValue()]:void 0)},selectionChanged:function(t){var e,n;return null!=(e=t.oldValue)&&e.domNodeClass("!"+this.itemActiveStyle),null!=(n=t.value)?n.domNodeClass(this.itemActiveStyle):void 0},childrenAdapter:function(t){var e,n,r,i,o,u;if(!t)return[];for(u=[],n=i=0,o=t.length;o>i;n=++i)e=t[n],r=this.childrenItemAdapter(e,n),r.domNodeNextSibling="undefined"!=typeof lastNode&&null!==lastNode?lastNode.nextSibling:void 0,u.push(r);return u},childrenItemAdapter:function(t){return{id:this.itemType,domNodeType:this.itemDomNodeType,style:this.itemStyle,template:this.itemTemplate,value:t[this.dataIdKey],data:t}},tapped:function(t){var e,n,r;for(n=t.entity;n&&n!==this;){if((e=n.value)&&(null!=(r=this.childrenRegistry)?r[e]:void 0)){this.setValue(e);break}n=n.parentView}return n}}}})}.call(this),function(){Object.entity.define({id:"webclient.AceEditor extends View",properties:["value","mode","theme"],css:"position: relative;height: 500px;",methods:function(t){return{init:function(){return t.init.call(this),this.editor.getSession().on("change",function(t){return function(){return t.defered?void 0:(t.defered=!0,Function.nextTick(1e3,t,function(){return this.defered=!1,this.isOnChange=!0,this.prop("value",this.editor.getValue()),this.isOnChange=!1}))}}(this))},domNodeChanged:function(t,e){return this.editor=window.ace.edit(e),this.editor.setTheme("ace/theme/chrome"),this.editor.getSession().setMode("ace/mode/coffee")},valueChanged:function(t,e){return this.isOnChange?void 0:this.editor.setValue(e)}}}})}.call(this),function(){Object.entity.define({id:"D3List extends List",properties:["delta"],methods:function(){var t;return t=function(t,e,n){var r,i,o,u;if(null==n&&(n={}),t)for(o=0,u=t.length;u>o;o++)r=t[o],(i=r[e])&&(n[i]=r);return n},{dataChanged:function(e,n){var r;return n?(this.dataRegistry=t(n,this.dataIdKey),this.childrenRegistry={},this.setChildren(Object.event.create({value:n,noReset:!0})),(r=this.getValue())&&!this.dataRegistry[r]?this.prop("value",null):void 0):void this.prop("dataCount",e.error?-2:-1)},deltaChanged:function(e,n){return this.dataRegistry=Object.update(this.dataRegistry||{},t(n,this.dataIdKey)),this.childrenRegistry||(this.childrenRegistry={}),this.setChildren(Object.event.create({value:n,noReset:!0}))},childrenAdapter:function(t){var e,n,r,i,o,u,s,a,l,c,d,h,p,f;if(c=[],e=this._children,this._children=[],n=0,e)for(d=0,p=e.length;p>d;d++)i=e[d],(s=i.value)&&(this.dataRegistry[s]?(this._children.push(i),this.childrenRegistry[s]=i,n++):i.done());if(t)for(u=h=0,f=t.length;f>h;u=++h)r=t[u],void 0===(s=r[this.dataIdKey])&&(s=r[this.dataIdKey]=Object.math.uuid()),(o=this.childrenRegistry[s])?(a=o.domNode,this.updateChild(o,r)):(n++,l=this.childrenItemAdapter(r,u),l.domNodeNextSibling=null!=a?a.nextSibling:void 0,c.push(l));return this.prop("dataCount",n),c},updateChild:function(t,e){return t.prop("data",Object.event.create({value:e,force:!0}))}}}})}.call(this);