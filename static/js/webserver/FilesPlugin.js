// Generated by CoffeeScript 1.8.0
(function() {
  Object.entity.define({
    id: 'webserver.FilesPlugin extends EventHandler',
    baseDir: './static',
    methods: function(_super) {
      var express, fs, path;
      fs = require('fs');
      path = require('path');
      express = require('express');
      return {
        config: function(app) {
          this.rootDir = path.dirname(require.main.filename);
          return app.use(express["static"](this.baseDir));
        },
        handleEvent: function(ev) {
          var cb, name;
          cb = ev.callback;
          name = path.resolve.apply(path, [this.rootDir].concat(ev.uri.path));
          return fs.exists(name, function(x) {
            if (x) {
              return fs.readFile(name, ev.encoding || "utf8", cb);
            } else {
              return cb({
                reason: "not-found",
                message: "File not found: " + name
              });
            }
          });
        }
      };
    }
  });

}).call(this);
